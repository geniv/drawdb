' Gambas class file

PUBLIC SUB _new()

END

PUBLIC SUB Form_Open()
  'DIM xml AS NEW XmlDocument
  'DIM node, subnode, nod AS XmlNode
  'DIM neco AS XmlNodeAttributes
  'DIM i, j AS Integer
  'DIM pok AS String

  'nacteni konfigurace
  Settings.Read(ME)
  Settings.Read(canvas)

  'GridView1.Columns.Count = 2
  'GridView1.Rows.Count = 2
  'GridView1.Columns.Width = 52

  'GridView1[0, 0].Text = "ahoj"
  'GridView1[1, 0].Picture = Picture["drawdb.png"]
  'GridView1[0, 1].Text = "tuuuuuuu"

  'DEBUG GridView1.X

  'ToolButton1.X = GridView1.X + GridView1[0, 1].X
  'ToolButton1.Y = GridView1.Y + GridView1[0, 1].Y

  'IF Lof(P) THEN READ #P, buffer, Lof(P)
  'xml.Open("php_layout.xml")
  'node = xml.Root
  'xml.FromString(data)
'DEBUG xml.Root.Children
'FOR i = 0 TO xml.Root.Children.Count - 1
'  node = xml.Root.Children[i]
'DEBUG node
'  FOR j = 0 TO node.Children.Count - 1
'    FOR EACH nod IN node.Children[j].Attributes
'      DEBUG nod.Name;; nod.Value
'    NEXT
    'neco = node.Children[j].Attributes
'    DEBUG node.Children[j].Name;; node.Children[j].Value
'  NEXT
'NEXT
  'pok = NEW XmlReader
  'pok.Open("updatelist.xml")
  'aa = pok.Node
  'DO WHILE pok.Node.Name <> "nodenameIamlookingfor"
     'pok.Read()
     'IF pok.Eof THEN BREAK
     'DEBUG pok.Node.Depth;; pok.Node.Name;; pok.Node.Value
     'aa.Attributes = pok.Node
   'LOOP
   'pok.Close()
END

PUBLIC SUB Form_Close()
  'ulozeni konfigurace
  Settings.Write(ME)
  Settings.Write(canvas)

END

PUBLIC SUB Button1_Click()
  DIM xml AS NEW XmlDocument
  DIM node AS XmlNode
  DIM i, j AS Integer
  DIM reg AS NEW region

  INC Application.Busy
  Button1.Enabled = FALSE
  ProgressBar1.Value = 0

  'Class.Load(region)

  xml.Open("php_layout.xml")
  'settings: xml.Root.Children[1]
  'regions: xml.Root.Children[3].Children[1].Children[]
  FOR i = 1 TO xml.Root.Children[3].Children[1].Children.Count - 1 STEP 2
    ProgressBar1.Value = Round(i / (xml.Root.Children[3].Children[1].Children.Count - 1), -1)
    'DEBUG Round(ProgressBar1.Value, -1);; "\nnovy region"
' FMain.Button1_Click.88: novy region
' FMain.Button1_Click.90: ID 5087
' FMain.Button1_Click.90: RegionName Vydane faktury
' FMain.Button1_Click.90: XPos 3428
' FMain.Button1_Click.90: YPos 44
' FMain.Button1_Click.90: Width 191
' FMain.Button1_Click.90: Height 601
' FMain.Button1_Click.90: RegionColor 3
' FMain.Button1_Click.90: TablePrefix 0
' FMain.Button1_Click.90: TableType 0
' FMain.Button1_Click.90: OverwriteTablePrefix 0
' FMain.Button1_Click.90: OverwriteTableType 0
' FMain.Button1_Click.90: Comments 
' FMain.Button1_Click.90: IsLinkedObject 0
' FMain.Button1_Click.90: IDLinkedModel - 1
' FMain.Button1_Click.90: Obj_id_Linked - 1
' FMain.Button1_Click.90: OrderPos 124
    'DEBUG "novy region"
    FOR EACH node IN xml.Root.Children[3].Children[1].Children[i].Attributes
      'DEBUG node.Name;; node.Value
      SELECT CASE node.Name
        CASE "ID"
          reg.id = CInt(node.Value)
        CASE "RegionName"
          reg.name = node.Value
        CASE "XPos"
          reg.x = CInt(node.Value)
        CASE "YPos"
          reg.y = CInt(node.Value)
        CASE "Width"
          reg.w = CInt(node.Value)
        CASE "Height"
          reg.h = CInt(node.Value)
        CASE "TablePrefix"
          BREAK 'vyskoci z cyklu, dalsi data jsou zatim zbytecna
      END SELECT
    NEXT  'konec foreach
    VytvorRegion(reg)
  NEXT 
  'node = xml.Root.Children[3].Children[1].Children
  'DEBUG node

  'Button3.X = 273
  'Button3.Y = 59

  Button1.Enabled = TRUE
  DEC Application.Busy

END

PRIVATE SUB VytvorRegion(reg AS region)
  DIM hreg AS Panel
  DIM hlab AS Label

  hreg = NEW Panel(canvas) AS "RegionPanel"
  hreg.Tag = reg.id
  hreg.Background = &HF0F1FE&
  hreg.Border = Border.Plain
  hreg.X = reg.x
  hreg.Y = reg.y
  hreg.Width = reg.w
  hreg.Height = reg.h

  hlab = NEW Label(hreg) AS "RegionLabel"
  hlab.Tag = reg.id
  hlab.Text = reg.name
  hlab.Foreground = &HA6A7AB&
  'move !
  hlab.X = 2
  hlab.Y = 2
  hlab.Width = reg.w - 3
  hlab.Height = 25

END

PUBLIC SUB RegionPanel_MouseDown()

  IF Mouse.Right THEN
      Message.Info(LAST.Tag & " ueee?")
  ENDIF 

END

PRIVATE SUB VytvorTabulku(tab AS table)

END

PUBLIC SUB Button2_Click()
DIM pok AS Button
  'DEBUG canvas.ScrollWidth;; canvas.ScrollHeight

  pok = NEW Button(canvas) AS "pokusnybutton"
  pok.Text = "Buttoon"
  pok.X = 273
  pok.Y = 59
  pok.Width = 100
  pok.Height = 100
  
  'canvas.ScrollWidth += 200

END
